<!--内容开始--><section class="content">    <div class="search">        <form class="form-inline" action="{:url('Book/index')}" data-pjax>            <input type="text" class="form-control" name="keyword" placeholder="书籍名称" value="{$keyword}">            <input class="btn btn-flat btn-primary" type="submit" value="搜索">            <a class="btn btn-flat btn-primary m_10" href="{:url('Book/index')}">显示全部</a>            <input class="btn btn-flat btn-warning m_10 select_del" type="button" value="批量删除">            <a class="btn btn-flat btn-success m_10 f_r " href="{:url('Book/updateCover')}" target="_blank"><i class="fa fa-repeat m-r-10"></i>更新封面</a>            <a class="btn btn-flat btn-success m_10 f_r" href='{:url('Book/update')}'><i class="fa fa-repeat m-r-10"></i>更 新</a>            <a class="btn btn-flat btn-success m_10 f_r" href='{:url('Book/add')}'><i class="fa fa-plus m-r-10"></i>添 加</a>        </form>    </div>    <!--数据表开始-->    <div class="row">        <div class="col-xs-12">            <div class="box">                <div class="box-header">                    <!-- /.box-header -->                    <div class="box-body table-responsive no-padding">                        <table class="table table-bordered table-hover">                            <tr>                                <th class="t_c"><input type="checkbox" id="check"></th>                                <th class="t_c">编号</th>                                <th class="t_c">分类</th>                                <th class="t_c">书籍名称</th>                                <th class="t_c">类型</th>                                <th class="t_c">添加时间</th>                                <th class="t_c">修改时间</th>                                <th class="t_c">状态</th>                                <th class="t_c">操作</th>                            </tr>                            {volist name='list' id='list' empty="$empty"}                            <tr>                                <td class="t_c"><input type="checkbox" name="key[]" value="{$list.id}"></td>                                <td class="t_c">{$list.id}</td>                                <td class="t_c">{$list.type_name}</td>                                <td class="t_c">{$list.name}</td>                                <td class="t_c">{$list.ext}</td>                                <th class="t_c">{$list.create_time|date="Y-m-d H:i:s"}</th>                                <th class="t_c">{$list.update_time|date="Y-m-d H:i:s"}</th>                                <td class="t_c">                                    {if $list.status==1}                                    <a class="state state_ok" data-id="{$list.id}"><i                                            class="fa fa-fw fa-check-square"></i></a>                                    {else}                                    <a class="state state_no" data-id="{$list.id}"><i                                            class="fa fa-fw fa-check-square"></i></a>                                    {/if}                                </td>                                <td class="t_c">                                    <a class="btn btn-flat btn-info btn-xs" href="{:url('edit',['id'=>$list.id])}">                                        <i class="fa fa-edit"></i> 编辑                                    </a>                                    <a class="btn btn-flat btn-warning btn-xs list_del" data-id="{$list.id}">                                        <i class="fa fa-trash-o"></i> 删除                                    </a>                                </td>                            </tr>                            {/volist}                        </table>                    </div>                    <!-- /.box-body -->                    <div class="box-footer clearfix page">                        {$page|raw}                        <!---->                        {$pageSize|raw}                        <!---->                    </div>                </div>                <!-- /.box -->            </div>        </div>    </div>    <!--数据表结束--></section><!--内容结束--><script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script><script src="/static/common/epub/epub.js"></script><script>    //删除    $(".list_del").click(function () {        var url = "{:url('Book/del')}";        var id = $(this).data("id");        delOne(url, id)    })    //状态    $(".state").click(function () {        var url = "{:url('Book/state')}";        var id = $(this).data("id");        changeState(url, id);    })    //批量删除    $(".select_del").click(function () {        var url = "{:url('Book/selectDel')}";        delSelect(url);    })    //显示数量    $(".page_size").change(function () {        var page_size = $(this).val();        var url = "{:url('index',['page_size'=>'pagesize'])}";        url = url.replace("pagesize", page_size);        pjaxReplace(url);    });    //更新封面    $(".updateCover").click(function(){        var page = 37;        updateCover(page);    });    function updateCover(page){        var url = "{:url('Book/list')}";        $.post(url,{page:page},function(result){            if(result.code == 1 ){                var data = result.data.data;                var last_page = result.data.last_page;                for (i = 0; i < data.length; i++) {                    var book = ePub("https://nenyes.oss-cn-shenzhen.aliyuncs.com/yuedu/book/心理励志/人间失格.epub");                    var rendition = book.renderTo("viewer", {                        width: "100%",                        height: 600,                        spread: "always"                    });                    rendition.display();                    book.ready.then(function() {                        var keyListener = function(e){                            // Left Key                            if ((e.keyCode || e.which) == 37) {                                book.package.metadata.direction === "rtl" ? rendition.next() : rendition.prev();                            }                            // Right Key                            if ((e.keyCode || e.which) == 39) {                                book.package.metadata.direction === "rtl" ? rendition.prev() : rendition.next();                            }                        };                        rendition.on("keyup", keyListener);                        document.addEventListener("keyup", keyListener, false);                        //获取封面                        book.loaded.metadata.then(() => {                            console.log(book.cover );                            if( book.cover ){                                book.archive.getBase64(book.cover).then(value => {                                    localStorage.setItem(localStorage.getItem('defaultBook') + 'cover', value)                                    console.log(value);                                })                            } else {                                let images = [];                                console.log(book.archive.urlCache.length);                                for (i = 0; i < book.archive.urlCache.length; i++) {                                    console.log( book.archive.urlCache[i] );                                }                                let bookImages = images.sort((a,b)=>{                                    return a<b;                                })                                console.log(bookImages);                            }                        })                    })                    var title = document.getElementById("title");                    rendition.on("rendered", function(section){                        var current = book.navigation && book.navigation.get(section.href);                        if (current) {                            var $select = document.getElementById("toc");                            var $selected = $select.querySelector("option[selected]");                            if ($selected) {                                $selected.removeAttribute("selected");                            }                            var $options = $select.querySelectorAll("option");                            for (var i = 0; i < $options.length; ++i) {                                let selected = $options[i].getAttribute("ref") === current.href;                                if (selected) {                                    $options[i].setAttribute("selected", "");                                }                            }                        }                    });                    rendition.on("relocated", function(location){                        console.log(location);                        var next = book.package.metadata.direction === "rtl" ?  document.getElementById("prev") : document.getElementById("next");                        var prev = book.package.metadata.direction === "rtl" ?  document.getElementById("next") : document.getElementById("prev");                        if (location.atEnd) {                            next.style.visibility = "hidden";                        } else {                            next.style.visibility = "visible";                        }                        if (location.atStart) {                            prev.style.visibility = "hidden";                        } else {                            prev.style.visibility = "visible";                        }                    });                    rendition.on("layout", function(layout) {                        let viewer = document.getElementById("viewer");                        if (layout.spread) {                            viewer.classList.remove('single');                        } else {                            viewer.classList.add('single');                        }                    });                    window.addEventListener("unload", function () {                        console.log("unloading");                        this.book.destroy();                    });                    book.loaded.navigation.then(function(toc){                        var $select = document.getElementById("toc"),                            docfrag = document.createDocumentFragment();                        toc.forEach(function(chapter) {                            var option = document.createElement("option");                            option.textContent = chapter.label;                            option.setAttribute("ref", chapter.href);                            docfrag.appendChild(option);                        });                        $select.appendChild(docfrag);                        $select.onchange = function(){                            var index = $select.selectedIndex,                                url = $select.options[index].getAttribute("ref");                            rendition.display(url);                            return false;                        };                    });                }            }else{                swal(result.msg,'','error');            }        })    }</script>