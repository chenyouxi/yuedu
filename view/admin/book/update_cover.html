{__NOLAYOUT__}<!DOCTYPE html><html><head>    <meta charset="utf-8">    <meta name="viewport" content="width=device-width, initial-scale=1">    <title>EPUB.js Spreads Example</title>    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>    <script src="/static/common/epub/epub.js"></script>    <script src="/static/plugins/AdminLTE/bower_components/jquery/dist/jquery.min.js"></script></head><body><select id="toc"></select><div id="viewer" class="spreads"></div><script>    // Load the opf    var book = ePub("{$info.bookUrl}");    var rendition = book.renderTo("viewer", {        width: "100%",        height: 600,        spread: "always"    });    rendition.display();    book.ready.then(function() {        //获取封面        book.loaded.metadata.then(() => {            if( book.cover ){                book.archive.getBase64(book.cover).then(value => {                    localStorage.setItem(localStorage.getItem('defaultBook') + 'cover', value)                    console.log(value);                    if(value){                        var id = "{$info.id}";                        $.post("{:url('Book/updateCover')}",{pic:value,id:id},function(result){                            console.log(result);                        })                    }                })            } else {                window.localhost = "{:url('Book/updateCover')}";                let images = [];                for(let i in book.archive.urlCache ){                  let item = book.archive.urlCache[i];// console.log(i.indexOf('/images/'));                  if( i.indexOf('/images/') != -1 ){                    images.push({                      label:i,                      url:item                    })                  }                }                // console.log(book.archive.urlCache.length);                // for (i = 0; i < book.archive.urlCache.length; i++) {                //     console.log( book.archive.urlCache[i] );                // }                let bookImages = images.sort((a,b)=>{                    return a<b;                })                // console.log(bookImages);            }        })    })    var title = document.getElementById("title");    rendition.on("rendered", function(section){        var current = book.navigation && book.navigation.get(section.href);        if (current) {            var $select = document.getElementById("toc");            var $selected = $select.querySelector("option[selected]");            if ($selected) {                $selected.removeAttribute("selected");            }            var $options = $select.querySelectorAll("option");            for (var i = 0; i < $options.length; ++i) {                let selected = $options[i].getAttribute("ref") === current.href;                if (selected) {                    $options[i].setAttribute("selected", "");                }            }        }    });    rendition.on("relocated", function(location){        console.log(location);        var next = book.package.metadata.direction === "rtl" ?  document.getElementById("prev") : document.getElementById("next");        var prev = book.package.metadata.direction === "rtl" ?  document.getElementById("next") : document.getElementById("prev");        if (location.atEnd) {            next.style.visibility = "hidden";        } else {            next.style.visibility = "visible";        }        if (location.atStart) {            prev.style.visibility = "hidden";        } else {            prev.style.visibility = "visible";        }    });    rendition.on("layout", function(layout) {        let viewer = document.getElementById("viewer");        if (layout.spread) {            viewer.classList.remove('single');        } else {            viewer.classList.add('single');        }    });    window.addEventListener("unload", function () {        console.log("unloading");        this.book.destroy();    });    book.loaded.navigation.then(function(toc){        var $select = document.getElementById("toc"),            docfrag = document.createDocumentFragment();        toc.forEach(function(chapter) {            var option = document.createElement("option");            option.textContent = chapter.label;            option.setAttribute("ref", chapter.href);            docfrag.appendChild(option);        });        $select.appendChild(docfrag);        $select.onchange = function(){            var index = $select.selectedIndex,                url = $select.options[index].getAttribute("ref");            rendition.display(url);            return false;        };    });</script></body></html>