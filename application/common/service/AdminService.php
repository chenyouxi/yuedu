<?php/** * Created by PhpStorm. * User: chenyouxi * Date: 2019/7/17 * Time: 5:15 PM */namespace app\common\service;use think\facade\Session as Session;use think\facade\Cookie as Cookie;use think\facade\Cache;use think\facade\Request;use app\common\model\AdminModel as AdminModel;use think\Db;class AdminService{    private $admin;    function __construct()    {        $this->admin = new AdminModel();    }    public function checkLogin()    {        $username = Request::param("username");        $password = Request::param("password");        $code = Request::param("vercode");        if (!captcha_check($code)) {            result_error('000103','验证码错误');        }        $result = $this->admin->getInfo(['userName' => $username, 'userPass' => substr(md5($password), 0, 30)]);        if (empty($result)) {            result_error('000101','帐号或密码错误');        } else {            if ($result['status'] == 1) {                $uid = $result['userId'];                //更新登录IP和登录时间                $this->admin->where('userId', '=', $uid)->update(['lastLoginTime' => time(), 'lastLoginIp' => Request::ip()]);                Session::set('admin', [                    'userId'        => $result['userId'],                    'userName'  => $result['userName'],                    'lastLoginTime' => date('Y-m-d H:i:s', $result['lastLoginTime']),                    'lastLoginIp'   => $result['lastLoginIp'],                ]);                result_success('','登录成功');            } else {                result_error('000102','用户已被禁用！');            }        }    }    public function getList($page_index, $page_size, $condition, $order,$field){        $list = $this->article->pageQuery($page_index, $page_size, $condition, $order, $field);        return $list;    }    public function getView($condition = '', $field = '*'){        $info  = $this->article->getInfo($condition,$field);        return $info;    }}