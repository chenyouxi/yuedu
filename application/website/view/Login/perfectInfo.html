{include file="./public/header" }<style>    .tab-content{        background:#fff;    }</style><div class="header w1200">    <a href="/">        <img alt="logo" src="__IMG__/logo.png">    </a></div><div class="ns-main w1200">    <ul class="nav nav-tabs">        <li class="general-registration active">            <a data-tab="tab1" href="javascript:;">完善信息</a>        </li>        <li class="general-registration" style="width:150px;">            <a data-tab="tab2" href="javascript:;">已有账号绑定</a>        </li>    </ul>    <div class="tab-content">        <p style="margin-left: 56px;color:red;margin-bottom: 30px;font-size:12px;">            <span>* 友情提示：使用平台功能前，请先绑定手机号，谢谢！！！</span>        </p>        <!-- 完善信息  -->        <div class="tab-pane active" id="tab1">            <div class="form-group row mb-4">                <label class="col-sm-2">                    <span class="ns-text-color">*</span>                    <span class="switching-user-names">手机号：</span>                </label>                <div class="col-sm-4" >                    <input id="mobile" type="text" maxlength="11" placeholder="手机号" class="form-control form-control-sm" onKeyPress="if (event.keyCode == 13) perfectInfo();">                </div>            </div>            <div class="form-group row mb-4">                <label class="col-sm-2" >                    <span class="ns-text-color">*</span>                    <span>手机验证码：</span>                </label>                <div class="col-sm-2" >                    <input id="codeMobile" type="text" placeholder="请输入手机验证码" class="form-item form-control form-control-sm" onKeyPress="if (event.keyCode == 13) perfectInfo();" >                </div>                <div class="  list-inline-item item" style="margin:auto 0;">                    <button  class=" btn btn-primary btn-sm btn-block code" onclick="getCode(this);" type="button" >                        获取手机验证码                    </button>                </div>            </div>            <div class="form-group row mb-4">                <label class="col-sm-2" >                    <span class="ns-text-color">*</span>                    <span>密码：</span>                </label>                <div class="col-sm-4" >                <input id="pass" type="password" placeholder="请输入密码" class="form-control form-control-sm" onKeyPress="if (event.keyCode == 13) perfectInfo();" >                </div>            </div>            <div class="form-group row mb-4">                <label class="col-sm-2">                    <span class="ns-text-color">*</span>                    <span>确认密码：</span>                </label>                <div class="col-sm-4" >                <input id="repass" type="password" placeholder="请重新输入密码" class="form-control form-control-sm" onKeyPress="if (event.keyCode == 13) perfectInfo();" >                </div>            </div>            <div class="form-group row mb-4">                <label class="col-sm-2" >                    <span class="ns-text-color">*</span>                    <span>校验码：</span>                </label>                <div class="col-sm-2" >                    <input id="verify_code" type="text" placeholder="请输入校验码" class="form-item form-control form-control-sm" onKeyPress="if (event.keyCode == 13) perfectInfo();" >                </div>                <label class="img">                    <img class="verifyimg" src="/website/verify" onclick="this.src='/website/verify?tag=1'+'&amp;send='+Math.random()" alt="看不清; 点击更换校验码" title="看不清; 点击更换校验码">                </label>            </div>            <div class="col-12 col-sm-2 offset-sm-4">                <label></label>                <button class="btn btn-primary btn-sm btn-block " type="button" onclick="perfectInfo();" >                    <span class="iconfont icon-correct font-size-1 mr-1"></span>                    完善信息                </button>            </div>        </div>        <!-- 绑定现有帐号 -->        <div class="tab-pane" id="tab2">            <div class="form-group row mb-4">                <label class="col-sm-2">                    <span class="ns-text-color">*</span>                    <span class="switching-user-names">手机号：</span>                </label>                <div class="col-sm-4" >                    <input id="b-mobile" type="text" maxlength="11" placeholder="手机号" class="form-control form-control-sm" onKeyPress="if (event.keyCode == 13) bindMobile();">                </div>            </div>            <div class="form-group row mb-4">                <label class="col-sm-2" >                    <span class="ns-text-color">*</span>                    <span>手机验证码：</span>                </label>                <div class="col-sm-2" >                    <input id="b-codeMobile" type="text" placeholder="请输入手机验证码" class="form-item form-control form-control-sm" onKeyPress="if (event.keyCode == 13) bindMobile();" >                </div>                <div class="  list-inline-item item" style="margin:auto 0;">                    <button  class=" btn btn-primary btn-sm btn-block code" onclick="bgetCode(this);" type="button" >                        获取手机验证码                    </button>                </div>            </div>            <div class="form-group row mb-4">                <label class="col-sm-2" >                    <span class="ns-text-color">*</span>                    <span>密码：</span>                </label>                <div class="col-sm-4" >                    <input id="b-pass" type="password" placeholder="请输入密码" class="form-control form-control-sm" onKeyPress="if (event.keyCode == 13) bindMobile();" >                </div>            </div>            <div class="form-group row mb-4">                <label class="col-sm-2" >                    <span class="ns-text-color">*</span>                    <span>校验码：</span>                </label>                <div class="col-sm-2" >                    <input id="b-verify_code" type="text" placeholder="请输入校验码" class="form-item form-control form-control-sm" onKeyPress="if (event.keyCode == 13) bindMobile();" >                </div>                <label class="img">                    <img class="verifyimg" src="/website/verify" onclick="this.src='/website/verify?tag=1'+'&amp;send='+Math.random()" alt="看不清; 点击更换校验码" title="看不清; 点击更换校验码">                </label>            </div>            <div class="col-12 col-sm-2 offset-sm-4">                <label></label>                <button class="btn btn-primary btn-sm btn-block " type="button" onclick="bindMobile();" >                    <span class="iconfont icon-correct font-size-1 mr-1"></span>                    绑定手机号                </button>            </div>        </div>    </div></div><script>    $(function () {        $("#mobile").change(function () {            if ($(this).val().length>=3 && $(this).val().length<=16) {                var mobile = $(this).val();                if (mobile.length == 0) {                    $("#mobile").trigger("focus").addClass("ns-border-color");                    layer.msg("手机号不能为空");                    return false;                } else {                    $("#mobile").removeClass("ns-border-color");                }                if (mobile.search(regex.mobile) == -1) {                    $("#mobile").trigger("focus").addClass("ns-border-color");                    layer.msg("手机号码不正确");                    return false;                } else {                    $("#mobile").removeClass("ns-border-color");                }                $.post("/website/checkMobile", {"mobile": mobile}, function (data) {                    if (data.data == "111131") {                        $("#mobile").focus().addClass("ns-border-color");                        layer.msg(data.msg);                    } else {                        $("#mobile").removeClass("ns-border-color");                    }                },"json");            }        });        $("#pass").change(function () {            var password = $("#pass").val();            if (password.length < 6) {                $("#pass").trigger("focus").addClass("ns-border-color");                layer.msg("密码最小长度为6位！");                return false;            } else {                $("#pass").removeClass("ns-border-color");            }        });        $("#repass").change(function () {            var password = $("#pass").val();            var repass = $("#repass").val();            if (!(repass == password)) {                $("#repass").trigger("focus").addClass("ns-border-color");                layer.msg("两次密码输入不相同");                return false;            } else {                $("#repass").removeClass("ns-border-color");            }        });        //绑定手机号        $("#b-mobile").change(function () {            if ($(this).val().length>=3 && $(this).val().length<=16) {                var mobile = $(this).val();                if (mobile.length == 0) {                    $("#b-mobile").trigger("focus").addClass("ns-border-color");                    layer.msg("手机号不能为空");                    return false;                } else {                    $("#b-mobile").removeClass("ns-border-color");                }                if (mobile.search(regex.mobile) == -1) {                    $("#b-mobile").trigger("focus").addClass("ns-border-color");                    layer.msg("手机号码不正确");                    return false;                } else {                    $("#b-mobile").removeClass("ns-border-color");                }                $.post("/website/checkMobile", {"mobile": mobile}, function (data) {                    if (data.data == "111132") {                        $("#b-mobile").focus().addClass("ns-border-color");                        layer.msg(data.msg);                    } else {                        $("#b-mobile").removeClass("ns-border-color");                    }                },"json");            }        });        $("#b-pass").change(function () {            var password = $("#b-pass").val();            if (password.length < 6) {                $("#b-pass").trigger("focus").addClass("ns-border-color");                layer.msg("密码最小长度为6位！");                return false;            } else {                $("#b-pass").removeClass("ns-border-color");            }        });    });    function perfectInfo() {        var mobile = $("#mobile").val();        var password = $("#pass").val();        var repass = $("#repass").val();        var verify_code = $("#verify_code").val();        var codeMobile = $("#codeMobile").val();        if (mobile.length == 0) {            $("#mobile").trigger("focus").addClass("ns-border-color");            layer.msg("手机号不能为空");            return false;        } else {            $("#mobile").removeClass("ns-border-color");        }        if (mobile.search(regex.mobile) == -1) {            $("#mobile").trigger("focus").addClass("ns-border-color");            layer.msg("手机号码不正确");            return false;        } else {            $("#mobile").removeClass("ns-border-color");        }        // 手机验证码        if (codeMobile == "") {            $("#codeMobile").focus().addClass("ns-border-color");            layer.msg("请输入手机验证码！");            return false;        } else {            $("#codeMobile").removeClass("ns-border-color");        }        var is_password_true = verifyPassword(password);        if (is_password_true > 0) {            return false;        }        if (!(repass == password)) {            $("#repass").trigger("focus").addClass("ns-border-color");            layer.msg("两次密码不一致！");            return false;        } else {            $("#repass").removeClass("ns-border-color");        }        // 校验码        if (verify_code == "") {            $("#verify_code").focus().addClass("ns-border-color");            layer.msg("请输入校验码！");            return false;        } else {            $("#verify_code").removeClass("ns-border-color");        }        $.post("/website/bindMobile", {            "mobile": mobile,            "password": password,            "captcha": verify_code,            "codeMobile":codeMobile,            "type":1,            "ticket":"{$ticket}"        }, function (data) {            console.log(data);            if (data.status == "success") {                layer.msg( data.msg );                setTimeout(function () {                    location.href = data.data.url;                }, 1000);            } else {                layer.msg( data.msg );                if( data.code == "111111" ){                    $("#mobile").focus().addClass("ns-border-color");                }else if(data.code == "111121"){                    $(".verifyimg").attr("src",  '/website/verify?tag=1&send=' + Math.random());                    $("#verify_code").focus().addClass("ns-border-color");                } else if (data.code == "111122"){                    $("#codeMobile").focus().addClass("ns-border-color");                }            }        },"json");    }    function bindMobile() {        var mobile = $("#b-mobile").val();        var password = $("#b-pass").val();        var verify_code = $("#b-verify_code").val();        var codeMobile = $("#b-codeMobile").val();        if (mobile.length == 0) {            $("#b-mobile").trigger("focus").addClass("ns-border-color");            layer.msg("手机号不能为空");            return false;        } else {            $("#b-mobile").removeClass("ns-border-color");        }        if (mobile.search(regex.mobile) == -1) {            $("#b-mobile").trigger("focus").addClass("ns-border-color");            layer.msg("手机号码不正确");            return false;        } else {            $("#b-mobile").removeClass("ns-border-color");        }        //校验密码是否正确        if ($.trim(password) == "") {            $("#b-pass").trigger("focus").addClass("ns-border-color");            layer.msg("密码不能为空！");            return false;        } else {            $("#b-pass").removeClass("ns-border-color");        }        if (password.length < 6) {            $("#b-pass").trigger("focus").addClass("ns-border-color");            layer.msg("密码不能小于6位！");            return false;        } else {            $("#b-pass").removeClass("ns-border-color");        }        // 验证码        if (codeMobile == "") {            $("#b-codeMobile").focus().addClass("ns-border-color");            layer.msg("请输入手机验证码！");            return false;        } else {            $("#b-codeMobile").removeClass("ns-border-color");        }        // 校验码        if (verify_code == "") {            $("#b-verify_code").focus().addClass("ns-border-color");            layer.msg("请输入校验码！");            return false;        } else {            $("#b-verify_code").removeClass("ns-border-color");        }        $.post("/website/bindMobile", {            "mobile": mobile,            "password": password,            "captcha": verify_code,            "codeMobile":codeMobile,            "type":2,            "ticket":"{$ticket}"        }, function (data) {            console.log(data);            if (data.status == "success") {                layer.msg( data.msg );                setTimeout(function () {                    location.href = data.data.url;                }, 1000)            } else {                layer.msg( data.msg );                if( data.code == "111111" ){                    $("#b-mobile").focus().addClass("ns-border-color");                }else if( data.code == "111121" ){                    $(".verifyimg").attr("src",  '/website/verify?tag=1&send=' + Math.random());                    $("#b-verify_code").focus().addClass("ns-border-color");                } else if ( data.code == "111122" ){                    $("#b-codeMobile").focus().addClass("ns-border-color");                } else if ( data.code == "111123" ){                    $("#b-pass").focus().addClass("ns-border-color");                }            }        },"json");    }    //验证密码    function verifyPassword(password) {        var is_true = 0;        var min_length = 6;        if ($.trim(password) == "") {            is_true = 1;            $("#pass").trigger("focus").addClass("ns-border-color");            layer.msg("密码不能为空！");            return is_true;        } else {            $("#pass").removeClass("ns-border-color");        }        if (min_length > 0) {            if (password.length < min_length) {                is_true = 1;                $("#pass").trigger("focus").addClass("ns-border-color");                layer.msg("密码不能小于6位！");                return is_true;            } else {                $("#pass").removeClass("ns-border-color");            }        }        return is_true;    }    //绑定信息的js    var flag = false; // 防止重复提交    function loginBind() {        var binding_username = $("#binding_username").val(),            binding_code_mobile = $("#binding_code_mobile").val(),            binding_verify_code = $("#binding_verify_code").val();        if (vertify(binding_username, binding_code_mobile, binding_verify_code)) {            if (flag) return;            flag = true;            $.post("/website/bindMobile", {                "mobile": binding_username,                "codeMobile":binding_code_mobile,                "captcha": binding_verify_code            }, function (data) {                if (data.status == "success") {                    layer.msg(data.msg);                    setTimeout(function () {                        location.href = "/website/member";                    }, 1000)                } else {                    layer.msg(data.msg);                    flag = false;                }            });        }    }    function vertify(binding_username, binding_code_mobile, binding_pass, binding_verify_code) {        if (binding_username.length == 0) {            $("#binding_username").focus().addClass("ns-border-color");            layer.msg("请输入手机号！");            return false;        } else {            $("#binding_username").removeClass("ns-border-color");        }        if (binding_code_mobile.length == 0) {            $("#binding_code_mobile").focus().addClass("ns-border-color");            layer.msg("请输入手机验证码！");            return false;        } else {            $("#binding_code_mobile").removeClass("ns-border-color");        }        if (binding_verify_code.length == 0 && binding_verify_code != undefined) {            $("#binding_verify_code").focus().addClass("ns-border-color");            layer.msg("请输入校验码！");            return false;        } else {            $("#binding_verify_code").removeClass("ns-border-color");        }        return true;    }    //倒计时    //var wait = 60;    function countDown(chageObj, oldText,time) {        var time = time != undefined ? time : 60,        oldText = oldText != undefined ? oldText : '获取手机验证码',            text = time + 's后重新获取';        if (time > 0) {            $(chageObj).text(text).addClass('disabled');            time -= 1;            setTimeout(function () {                countDown(chageObj, oldText ,time);            }, 1000);        } else {            console.log(time);            $(chageObj).text(oldText).removeClass('disabled');        }    }    //发送短信验证码    function getCode(event){        var mobile = $("#mobile").val();        var isDisabled = $(event).hasClass("disabled");        var type = "perfect";        if (mobile.length == 0) {            $("#mobile").trigger("focus").addClass("ns-border-color");            layer.msg("手机号不能为空");            return false;        } else {            $("#mobile").removeClass("ns-border-color");        }        if (mobile.search(regex.mobile) == -1) {            $("#mobile").trigger("focus").addClass("ns-border-color");            layer.msg("手机号码不正确");            return false;        } else {            $("#mobile").removeClass("ns-border-color");        }        if(!isDisabled){            countDown(event);            //发送手机邮箱验证码            $.post("/website/sms", {"type": type, "mobile": mobile}, function (res) {                console.log(res);                if (res.status == "error") {                    layer.msg(res.msg);                    return false;                }            }, "json");        }    }    function bgetCode(event){        var mobile = $("#b-mobile").val();        var isDisabled = $(event).hasClass("disabled");        var type = "bindMobile";        if (mobile.length == 0) {            $("#b-mobile").trigger("focus").addClass("ns-border-color");            layer.msg("手机号不能为空");            return false;        } else {            $("#b-mobile").removeClass("ns-border-color");        }        if (mobile.search(regex.mobile) == -1) {            $("#b-mobile").trigger("focus").addClass("ns-border-color");            layer.msg("手机号码不正确");            return false;        } else {            $("#b-mobile").removeClass("ns-border-color");        }        if(!isDisabled){            countDown(event);            //发送手机邮箱验证码            $.post("/website/sms", {"type": type, "mobile": mobile}, function (res) {                console.log(res);                if (res.status == "error") {                    layer.msg(res.msg);                    return false;                }            }, "json");        }    }    //切换tab    $(".nav-tabs li").click(function(){        $(this).siblings().removeClass("active");        $(this).addClass("active");        var tab = $(this).children("a").data("tab");        if(tab == "tab1"){            $("#tab1").show();            $("#tab2").hide();        } else if (tab == "tab2"){            $("#tab2").show();            $("#tab1").hide();        }    });</script>{include file="./public/footer" }