{include file="./public/header" }{include file="./public/navbar" }{css rel="stylesheet" href="__CSS__/member_security.css" }<style></style><div class="ns-main w1200">    {include file="./public/member_menu" }    <div class="member-main">        <!-- 修改密码 -->        <section>            <div class="main-top">                <div class="title">修改登录密码</div>            </div>            <div class="setting-cont clearfix">                <div class="stepflex stepflex-te">                    <dl class="normal doing ns-border-color">                        <dt class="s-num ns-bg-color">1</dt>                        <dd class="s-text">密码修改</dd>                    </dl>                    <dl class="last">                        <dt class="s-num ns-bg-color-gray">2</dt>                        <dd class="s-text"> 完成</dd>                    </dl>                </div>                <div class="form-horizontal">                    <div class="form-group">                        <label class="col-sm-2">手机号</label>                        <div class="col-md-6 col-sm-10 list-inline-item">                            <input type="text" class="form-control form-control-sm" maxlength="11"  name="mobile" placeholder="请输入手机号" onKeyPress="if (event.keyCode == 13) memberInfoOperation.confirm(this);"  >                        </div>                    </div>                    <div class="form-group">                        <label class="col-sm-2">验证码</label>                        <div class="col-md-3 col-sm-5 list-inline-item">                            <input type="text" style="width: 120px;" class="form-control form-control-sm" maxlength="6" name="verify" placeholder="请输入验证码" onKeyPress="if (event.keyCode == 13) memberInfoOperation.confirm(this);" >                        </div>                        <div class="col-md-3 col-sm-5 list-inline-item item">                            <button class="btn btn-primary btn-sm btn-block code" onclick="memberInfoOperation.sendSmsCaptcha(this);" type="button">获取验证码</button>                        </div>                    </div>                    <div class="form-group">                        <label class="col-sm-2">原密码</label>                        <div class="col-md-6 col-sm-10 list-inline-item">                            <input type="password" class="form-control form-control-sm" name="old_password" placeholder="请输入原密码" onKeyPress="if (event.keyCode == 13) memberInfoOperation.confirm(this);" >                        </div>                    </div>                    <div class="form-group">                        <label class="col-sm-2">新密码</label>                        <div class="col-md-6 col-sm-10 list-inline-item">                            <input type="password" class="form-control form-control-sm" name="new_password" placeholder="请输入新密码" onKeyPress="if (event.keyCode == 13) memberInfoOperation.confirm(this);" >                        </div>                    </div>                    <div class="form-group">                        <label class="col-sm-2">确认密码</label>                        <div class="col-md-6 col-sm-10 list-inline-item">                            <input type="password" class="form-control form-control-sm" name="re_new_password" placeholder="请再次确认密码" onKeyPress="if (event.keyCode == 13) memberInfoOperation.confirm(this);" >                        </div>                    </div>                    <div class="form-group">                        <div class="col-12 col-sm-2 offset-sm-4" >                            <button class="btn btn-primary btn-sm btn-block " type="button" onclick="memberInfoOperation.confirm(this);">                                <span class="iconfont icon-correct font-size-1 mr-1"></span>                                保存                            </button>                        </div>                    </div>                </div>                <div class="js-finish verify-success none" id="finish_password">                    <p>新密码重置完成!</p>                </div>            </div>        </section>    </div></div><script>    //倒计时    var wait = 60;    function countDown(chageObj, oldText) {        //var time = time != undefined ? time : 60,        oldText = oldText != undefined ? oldText : '获取动态码',            text = wait + 's后重新获取';        if (wait > 0) {            $(chageObj).text(text).addClass('disabled');            wait -= 1;            setTimeout(function () {                countDown(chageObj, oldText);            }, 1000);        } else {            console.log(wait);            $(chageObj).text(oldText).removeClass('disabled');        }    }    var isClick = false;    var memberInfoOperation = {        field: {},        confirm: function (event) {            this.getFieldValue(event);            if (this.verification()) {                if (isClick) return;                isClick = true;                this.submit();            }        },        // 表单提交        submit: function () {            var self = this;            $.post("/website/modifyPassword", self.field, function (res) {                sendCodeId = 0;                isClick = false;                if (res.status == "success") {                    layer.msg(res.msg);                    $(".doing").removeClass("ns-border-color");                    $(".doing .sum").removeClass("ns-bg-color");                    $(".doing .sum").addClass("ns-bg-color-gray");                    $(".last").addClass("ns-border-color");                    $(".last .sum").addClass("ns-border-color");                    $(".last .sum").removeClass("ns-bg-color-gray");                    $(".js-finish").show();                    $(".form-horizontal").hide();                    setTimeout(function () {                        location.href = '/website/memberSecurity';                    }, 2000);                }else{                    layer.msg(res.msg);                }            },"json");        },        // 数据验证        verification: function (is_submit) {            var self = this,                field = this.field;            $("input").each(function(){                $(this).removeClass("ns-border-color");            });            if (field.mobile == '') {                layer.msg('手机号不能为空');                $("input[name=mobile]").focus().addClass("ns-border-color");                return false;            } else if (field.mobile.search(regex.mobile) == -1) {                layer.msg('手机号格式不正确');                $("input[name=mobile]").focus().addClass("ns-border-color");                return false;            }            if (field.verify == '') {                layer.msg('请输入动态码');                $("input[name=verify]").focus().addClass("ns-border-color");                return false;            }            if (field.old_password == '') {                layer.msg('请输入原密码');                $("input[name=old_password]").focus().addClass("ns-border-color");                return false;            }            if (field.new_password == '') {                layer.msg('请输入新密码');                $("input[name=new_password]").focus().addClass("ns-border-color");                return false;            }            if (field.re_new_password != field.new_password) {                layer.msg('两次输入的密码不一致');                $("input[name=re_new_password]").focus().addClass("ns-border-color");                return false;            }            return true;        },        // 获取表单数据        getFieldValue: function (event) {            var self = this;            var formObj = $(event).parents('.form-horizontal');            if (formObj.find('[name]').length > 0) {                formObj.find('[name]').each(function () {                    var name = $(this).attr('name'),                        value = $(this).val();                    self['field'][name] = value;                })            }        },        // 发送短信验证码        sendSmsCaptcha: function (event) {            var mobile = $("input[name=mobile]").val();            var isDisabled = $(".code").hasClass("disabled");            if(!isDisabled){                if ( mobile == '') {                    layer.msg('手机号不能为空');                    $("input[name=mobile]").focus();                    return false;                } else if (mobile.search(regex.mobile) == -1) {                    layer.msg('手机号格式不正确');                    $("input[name=mobile]").focus();                    return false;                }                countDown(event);                $.post('/website/sms', {                    "mobile": mobile,                    "type": "savePassword"                }, function (data) {                    if (data.status == "success") {                        //countDown(event);                        layer.msg(data.msg);                    } else {                        layer.msg(data.msg);                        wait = 0;                        countDown(self, "获取动态码");                    }                }, "json");            }        }    };    $(function(){        var userMobile = "{$userMobile}" ? true : false;        if(!userMobile){            //如果未绑定手机号，提示绑定并跳转到绑定手机号页面            layer.msg("您未绑定手机号，请先绑定手机号！",{                icon:2,                time:3000,            });            setTimeout(function(){                window.location.href="/website/perfectInfo";            },3000)        }    })</script>{include file="./public/footer" }