<?php/** * * +---------------------------------------------------------------------- *                      .::::. *                    .::::::::.            | AUTHOR: chenyouxi *                    :::::::::::           | EMAIL: 905100794@qq.com *                 ..:::::::::::'           | QQ: 905100794 *             '::::::::::::'               | WECHAT: xi20130618 *                .::::::::::               | DATETIME: 2019/9/15 10:05 上午 *           '::::::::::::::.. *                ..::::::::::::. *              ``:::::::::::::::: *               ::::``:::::::::'        .:::. *              ::::'   ':::::'       .::::::::. *            .::::'      ::::     .:::::::'::::. *           .:::'       :::::  .:::::::::' ':::::. *          .::'        :::::.:::::::::'      ':::::. *         .::'         ::::::::::::::'         ``::::. *     ...:::           ::::::::::::'              ``::. *   ```` ':.          ':::::::::'                  ::::.. *                      '.:::::'                    ':'````.. * +---------------------------------------------------------------------- */namespace app\common\model;use think\facade\Request;class Book extends Base{    // 开启自动写入时间戳字段    protected $autoWriteTimestamp = false;    // 一对一获取所属用户组    public function bookType()    {        return $this->belongsTo('BookType', 'type_id');    }    // 一对一获取所属模型    public function module()    {        return $this->belongsTo('Module','moduleid');    }    // 获取列表    public static function getList($where = array(), $pageSize, $order = ['sort', 'id' => 'desc']){        $list = self::where($where)            ->order($order)            ->paginate([                'query'     => Request::get(),                'list_rows' => $pageSize,            ]);        foreach ($list as $k => $v) {            $v['type_name'] = $v->bookType->getData('name');            $v['fileUrl'] = "https://nenyes.oss-cn-shenzhen.aliyuncs.com/".$v['dirname']."/".$v['basename'];            if($v['ext'] == 'mobi'){                $extImg = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0i5Zu+5bGCXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgMzIgMzIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMyIDMyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPg0KCS5zdDB7ZmlsbDojRkY1NTYyO30NCgkuc3Qxe2ZpbGw6I0ZGQkJDMDt9DQoJLnN0MntmaWxsOiM4NUI5MTY7fQ0KCS5zdDN7ZmlsbDojREJGQ0VCO30NCgkuc3Q0e2ZpbGw6IzU1OUNFRDt9DQoJLnN0NXtmaWxsOiNBNENFRkQ7fQ0KCS5zdDZ7ZmlsbDojRkZDOTAwO30NCgkuc3Q3e2ZpbGw6I0ZGREY2Njt9DQoJLnN0OHtmaWxsOiM4Mzg5QUQ7fQ0KCS5zdDl7ZmlsbDojRENFMUZFO30NCgkuc3QxMHtmaWxsOiNGRkZGRkY7fQ0KPC9zdHlsZT4NCjxwYXRoIGNsYXNzPSJzdDQiIGQ9Ik00LjIsMEMzLjgsMCwzLjQsMC4yLDMuMSwwLjVTMi42LDEuMiwyLjYsMS42djI4LjhjMCwwLjQsMC4yLDAuOCwwLjUsMS4xQzMuNCwzMS44LDMuOCwzMiw0LjIsMzJoMjMuNg0KCWMwLjQsMCwwLjgtMC4yLDEuMS0wLjVjMC4zLTAuMywwLjUtMC43LDAuNS0xLjFWOS4xTDIwLjMsMEg0LjJ6Ii8+DQo8cGF0aCBjbGFzcz0ic3Q1IiBkPSJNMjkuNCw5LjFoLTcuNWMtMC40LDAtMC44LTAuMi0xLjEtMC41Yy0wLjMtMC4zLTAuNS0wLjctMC41LTEuMVYwTDI5LjQsOS4xeiIvPg0KPGc+DQoJPHBhdGggY2xhc3M9InN0MTAiIGQ9Ik0yMS41LDI1LjhsMC0xMS41bC01LDExLjVoLTFsLTQuNi0xMC42bC0wLjQtMC45djIuM3Y5LjNIOC43VjExLjdoMi41bDQuMiw5LjdjMC4zLDAuNywwLjUsMS4zLDAuNiwxLjdIMTYNCgkJYzAuMy0wLjksMC41LTEuNSwwLjctMS44bDQuMi05LjZoMi4zdjE0LjFIMjEuNXoiLz4NCjwvZz4NCjwvc3ZnPg0K";            } else if ($v['ext'] == 'pdf'){                $extImg = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0i5Zu+5bGCXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgMzIgMzIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMyIDMyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPg0KCS5zdDB7ZmlsbDojRkY1NTYyO30NCgkuc3Qxe2ZpbGw6I0ZGQkJDMDt9DQoJLnN0MntmaWxsOiM4NUI5MTY7fQ0KCS5zdDN7ZmlsbDojREJGQ0VCO30NCgkuc3Q0e2ZpbGw6IzU1OUNFRDt9DQoJLnN0NXtmaWxsOiNBNENFRkQ7fQ0KCS5zdDZ7ZmlsbDojRkZDOTAwO30NCgkuc3Q3e2ZpbGw6I0ZGREY2Njt9DQoJLnN0OHtmaWxsOiM4Mzg5QUQ7fQ0KCS5zdDl7ZmlsbDojRENFMUZFO30NCgkuc3QxMHtmaWxsOiNGRkZGRkY7fQ0KPC9zdHlsZT4NCjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00LjIsMEMzLjgsMCwzLjQsMC4yLDMuMSwwLjVTMi42LDEuMiwyLjYsMS42djI4LjhjMCwwLjQsMC4yLDAuOCwwLjUsMS4xQzMuNCwzMS44LDMuOCwzMiw0LjIsMzJoMjMuNg0KCWMwLjQsMCwwLjgtMC4yLDEuMS0wLjVjMC4zLTAuMywwLjUtMC43LDAuNS0xLjFWOS4xTDIwLjMsMEg0LjJ6Ii8+DQo8cGF0aCBjbGFzcz0ic3QxIiBkPSJNMjkuNCw5LjFoLTcuNWMtMC40LDAtMC44LTAuMi0xLjEtMC41Yy0wLjMtMC4zLTAuNS0wLjctMC41LTEuMVYwTDI5LjQsOS4xeiIvPg0KPHBhdGggY2xhc3M9InN0MTAiIGQ9Ik0yMS4yLDI1LjhjLTEuNywwLTMuMi0yLjktNC00LjdjLTEuMy0wLjYtMi44LTEuMS00LjItMS40Yy0xLjMsMC44LTMuNCwyLjEtNSwyLjFjLTEsMC0xLjctMC41LTItMS40DQoJYy0wLjItMC43LDAtMS4yLDAuMi0xLjVjMC40LTAuNiwxLjMtMC45LDIuNi0wLjljMS4xLDAsMi40LDAuMiwzLjksMC42YzEtMC43LDItMS41LDIuOS0yLjNjLTAuNC0xLjktMC44LTQuOSwwLjMtNi4zDQoJYzAuNS0wLjcsMS40LTAuOSwyLjMtMC42YzEuMSwwLjMsMS41LDEsMS42LDEuNWMwLjUsMS44LTEuNiw0LjMtMyw1LjdjMC4zLDEuMywwLjcsMi42LDEuMiwzLjhjMiwwLjksNC40LDIuMiw0LjcsMy43DQoJYzAuMSwwLjUtMC4xLDEtMC41LDEuNEMyMS45LDI1LjYsMjEuNiwyNS44LDIxLjIsMjUuOEwyMS4yLDI1Ljh6IE0xOC43LDIxLjdjMSwyLjEsMiwzLDIuNSwzYzAuMSwwLDAuMiwwLDAuMy0wLjINCgljMC4yLTAuMiwwLjItMC4zLDAuMi0wLjRDMjEuNiwyMy42LDIwLjcsMjIuOCwxOC43LDIxLjdMMTguNywyMS43eiBNOC44LDE5Yy0xLjMsMC0xLjcsMC4zLTEuOCwwLjVjMCwwLjEtMC4xLDAuMiwwLDAuNg0KCWMwLjEsMC4zLDAuMywwLjYsMSwwLjZjMC45LDAsMi4xLTAuNSwzLjUtMS4zQzEwLjUsMTkuMSw5LjYsMTksOC44LDE5eiBNMTQuMSwxOC44YzAuOSwwLjIsMS43LDAuNSwyLjYsMC45DQoJYy0wLjMtMC44LTAuNS0xLjYtMC43LTIuM0MxNS4zLDE3LjksMTQuNywxOC40LDE0LjEsMTguOEwxNC4xLDE4Ljh6IE0xNy40LDEwLjJjLTAuMywwLTAuNSwwLjEtMC43LDAuM2MtMC42LDAuNy0wLjYsMi41LTAuMiw0LjcNCgljMS42LTEuNywyLjUtMy4zLDIuMy00LjJjMC0wLjEtMC4xLTAuNS0wLjktMC43QzE3LjcsMTAuMywxNy42LDEwLjIsMTcuNCwxMC4yeiIvPg0KPC9zdmc+DQo=";            } else if ($v['ext'] == 'azw3'){                $extImg = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0i5Zu+5bGCXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgMzIgMzIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMyIDMyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPg0KCS5zdDB7ZmlsbDojRkY1NTYyO30NCgkuc3Qxe2ZpbGw6I0ZGQkJDMDt9DQoJLnN0MntmaWxsOiM4NUI5MTY7fQ0KCS5zdDN7ZmlsbDojREJGQ0VCO30NCgkuc3Q0e2ZpbGw6IzU1OUNFRDt9DQoJLnN0NXtmaWxsOiNBNENFRkQ7fQ0KCS5zdDZ7ZmlsbDojRkZDOTAwO30NCgkuc3Q3e2ZpbGw6I0ZGREY2Njt9DQoJLnN0OHtmaWxsOiM4Mzg5QUQ7fQ0KCS5zdDl7ZmlsbDojRENFMUZFO30NCgkuc3QxMHtmaWxsOiNGRkZGRkY7fQ0KPC9zdHlsZT4NCjxwYXRoIGNsYXNzPSJzdDYiIGQ9Ik00LjIsMEMzLjgsMCwzLjQsMC4yLDMuMSwwLjVTMi42LDEuMiwyLjYsMS42djI4LjhjMCwwLjQsMC4yLDAuOCwwLjUsMS4xQzMuNCwzMS44LDMuOCwzMiw0LjIsMzJoMjMuNg0KCWMwLjQsMCwwLjgtMC4yLDEuMS0wLjVjMC4zLTAuMywwLjUtMC43LDAuNS0xLjFWOS4xTDIwLjMsMEg0LjJ6Ii8+DQo8cGF0aCBjbGFzcz0ic3Q3IiBkPSJNMjkuNCw5LjFoLTcuNWMtMC40LDAtMC44LTAuMi0xLjEtMC41Yy0wLjMtMC4zLTAuNS0wLjctMC41LTEuMVYwTDI5LjQsOS4xeiIvPg0KPGc+DQoJPHBhdGggY2xhc3M9InN0MTAiIGQ9Ik0yMi4zLDI1LjhoLTJsLTEuNC0zLjlIMTNsLTEuNCwzLjloLTJMMTUsMTEuN0gxN0wyMi4zLDI1Ljh6IE0xOC4zLDIwLjRMMTYsMTMuOGwtMi40LDYuNUgxOC4zeiIvPg0KPC9nPg0KPC9zdmc+DQo=";            } else if($v['ext'] == 'epub'){                $extImg = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0i5Zu+5bGCXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgMzIgMzIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMyIDMyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPg0KCS5zdDB7ZmlsbDojRkY1NTYyO30NCgkuc3Qxe2ZpbGw6I0ZGQkJDMDt9DQoJLnN0MntmaWxsOiM4NUI5MTY7fQ0KCS5zdDN7ZmlsbDojREJGQ0VCO30NCgkuc3Q0e2ZpbGw6IzU1OUNFRDt9DQoJLnN0NXtmaWxsOiNBNENFRkQ7fQ0KCS5zdDZ7ZmlsbDojRkZDOTAwO30NCgkuc3Q3e2ZpbGw6I0ZGREY2Njt9DQoJLnN0OHtmaWxsOiM4Mzg5QUQ7fQ0KCS5zdDl7ZmlsbDojRENFMUZFO30NCgkuc3QxMHtmaWxsOiNGRkZGRkY7fQ0KPC9zdHlsZT4NCjxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik00LjIsMEMzLjgsMCwzLjQsMC4yLDMuMSwwLjVTMi42LDEuMiwyLjYsMS42djI4LjhjMCwwLjQsMC4yLDAuOCwwLjUsMS4xQzMuNCwzMS44LDMuOCwzMiw0LjIsMzJoMjMuNg0KCWMwLjQsMCwwLjgtMC4yLDEuMS0wLjVjMC4zLTAuMywwLjUtMC43LDAuNS0xLjFWOS4xTDIwLjMsMEg0LjJ6Ii8+DQo8cGF0aCBjbGFzcz0ic3QzIiBkPSJNMjkuNCw5LjFoLTcuNWMtMC40LDAtMC44LTAuMi0xLjEtMC41Yy0wLjMtMC4zLTAuNS0wLjctMC41LTEuMVYwTDI5LjQsOS4xeiIvPg0KPHBhdGggY2xhc3M9InN0MTAiIGQ9Ik0yNi4zLDE2LjdjLTAuMy0wLjMtMC45LTAuMy0xLjIsMGwtMy43LDMuN2wtNC4zLDQuM2MtMC43LDAuNy0xLjgsMC43LTIuNCwwbC02LjEtNi4xYy0wLjctMC43LTAuNy0xLjgsMC0yLjQNCglsNi4xLTYuMWMwLjctMC43LDEuOC0wLjcsMi40LDBsMi44LDIuOGwtNS44LDUuOGMtMC4yLDAuMi0wLjIsMC40LDAsMC42bDAuNiwwLjZjMC4yLDAuMiwwLjQsMC4yLDAuNiwwbDYuNy02LjcNCgljMC4yLTAuMiwwLjItMC40LDAtMC42bC0wLjYtMC42bDAsMGwtMy4xLTMuMWMtMS40LTEuMy0zLjUtMS4zLTQuOSwwbC02LjEsNi4xYy0xLjMsMS4zLTEuMywzLjUsMCw0LjlsNi4xLDYuMQ0KCWMxLjQsMS4zLDMuNSwxLjMsNC45LDBsNi4xLTYuMWwxLjgtMS44QzI2LjYsMTcuNiwyNi42LDE3LjEsMjYuMywxNi43TDI2LjMsMTYuN0wyNi4zLDE2Ljd6Ii8+DQo8L3N2Zz4NCg==";            } else if($v['ext'] == 'txt'){                $extImg = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0i5Zu+5bGCXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgMzIgMzIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMyIDMyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPg0KCS5zdDB7ZmlsbDojRkY1NTYyO30NCgkuc3Qxe2ZpbGw6I0ZGQkJDMDt9DQoJLnN0MntmaWxsOiM4NUI5MTY7fQ0KCS5zdDN7ZmlsbDojREJGQ0VCO30NCgkuc3Q0e2ZpbGw6IzU1OUNFRDt9DQoJLnN0NXtmaWxsOiNBNENFRkQ7fQ0KCS5zdDZ7ZmlsbDojRkZDOTAwO30NCgkuc3Q3e2ZpbGw6I0ZGREY2Njt9DQoJLnN0OHtmaWxsOiM4Mzg5QUQ7fQ0KCS5zdDl7ZmlsbDojRENFMUZFO30NCgkuc3QxMHtmaWxsOiNGRkZGRkY7fQ0KPC9zdHlsZT4NCjxnPg0KCTxwYXRoIGNsYXNzPSJzdDgiIGQ9Ik00LjIsMEMzLjgsMCwzLjQsMC4yLDMuMSwwLjVTMi42LDEuMiwyLjYsMS42djI4LjhjMCwwLjQsMC4yLDAuOCwwLjUsMS4xQzMuNCwzMS44LDMuOCwzMiw0LjIsMzJoMjMuNg0KCQljMC40LDAsMC44LTAuMiwxLjEtMC41YzAuMy0wLjMsMC41LTAuNywwLjUtMS4xVjkuMUwyMC4zLDBINC4yeiIvPg0KCTxwYXRoIGNsYXNzPSJzdDkiIGQ9Ik0yOS40LDkuMWgtNy41Yy0wLjQsMC0wLjgtMC4yLTEuMS0wLjVjLTAuMy0wLjMtMC41LTAuNy0wLjUtMS4xVjBMMjkuNCw5LjF6Ii8+DQo8L2c+DQo8Zz4NCgk8cGF0aCBjbGFzcz0ic3QxMCIgZD0iTTIxLDEzLjNoLTQuMXYxMi41aC0xLjhWMTMuM2gtNHYtMS42SDIxVjEzLjN6Ii8+DQo8L2c+DQo8L3N2Zz4NCg==";            } else {                $extImg = '';            }            $v['extImg'] = $extImg;            $v['bookUrl'] = "https://nenyes.oss-cn-shenzhen.aliyuncs.com/".str_replace("file","book",$v['dirname'])."/".$v['name'].".epub";        }        return $list;    }}