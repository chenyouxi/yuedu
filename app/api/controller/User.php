<?php/** * * +---------------------------------------------------------------------- *                      .::::. *                    .::::::::.            | AUTHOR: chenyouxi *                    :::::::::::           | EMAIL: 905100794@qq.com *                 ..:::::::::::'           | QQ: 905100794 *             '::::::::::::'               | WECHAT: xi20130618 *                .::::::::::               | DATETIME: 2019/9/28 7:35 上午 *           '::::::::::::::.. *                ..::::::::::::. *              ``:::::::::::::::: *               ::::``:::::::::'        .:::. *              ::::'   ':::::'       .::::::::. *            .::::'      ::::     .:::::::'::::. *           .:::'       :::::  .:::::::::' ':::::. *          .::'        :::::.:::::::::'      ':::::. *         .::'         ::::::::::::::'         ``::::. *     ...:::           ::::::::::::'              ``::. *   ```` ':.          ':::::::::'                  ::::.. *                      '.:::::'                    ':'````.. * +---------------------------------------------------------------------- */namespace app\api\controller;use think\facade\Db;use think\facade\Cache;use think\facade\Env;use think\facade\Request;use app\common\model\Users;use app\common\model\Book;use app\common\model\BookType;use app\common\model\UserBookshelf;class User extends Base{    //个人中心    public function index(){        $sessionId = input('post.SESSION_ID');        $session = Cache::get($sessionId);        if(!$session){            $this->error("登录已失效，请重新登录！");        } else {            $userInfo = Users::getInfoForId($session['user_id']);            if($userInfo->status == 0){                $this->error("该账号已禁用！");            }            $data['mobile'] = $userInfo->mobile;            $data['sex'] = $userInfo->sex;            $data['type_id'] = $userInfo->type_id;            $data['status'] = $userInfo->status;            $data['type_name'] = $userInfo->type_name;            $data['qq'] = $userInfo->qq;            $data['email'] = $userInfo->email;            $this->success("成功！",'',$data);        }    }    //编辑个人中心    public function edit(){    }    //我的书架    public function bookshelf(){        $sessionId = input('post.SESSION_ID');        $page = input('post.page');        $pageSize = input('post.pageSize',12);        $session = Cache::get($sessionId);        if(!$session){            $this->error("登录已失效，请重新登录！");        } else {            $list = UserBookshelf::getList(['user_id'=>$session['user_id']] , $pageSize);            $this->success("成功!",'',$list);        }    }    //添加书籍到我的书架    public function addBookshelf(){        $book_id = input('post.book_id');        $sessionId = input('post.SESSION_ID');        $session = Cache::get($sessionId);        if(!$session){            $this->error("登录已失效，请重新登录！");        } else {            $userInfo = Users::getInfoForId($session['user_id']);            if($userInfo->status == 0){                $this->error("该账号已禁用！");            }            $data['book_id'] = $book_id;            $data['user_id'] = $userInfo->id;            $result = UserBookshelf::create($data);            if($result){                $this->success("成功!");            } else {                $this->error("失败!");            }        }    }}